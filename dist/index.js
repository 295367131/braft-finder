!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("react"));else if("function"==typeof define&&define.amd)define(["react"],t);else{var n="object"==typeof exports?t(require("react")):t(e.react);for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}(window,function(t){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=8)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.UniqueIndex=function(){return isNaN(window.__BRAFT_MM_UNIQUE_INDEX__)?window.__BRAFT_MM_UNIQUE_INDEX__=1:window.__BRAFT_MM_UNIQUE_INDEX__+=1,window.__BRAFT_MM_UNIQUE_INDEX__}},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={remove:"删除",cancel:"取消",confirm:"确认",insert:"插入所选项目",width:"宽度",height:"高度",image:"图片",video:"视频",audio:"音频",embed:"嵌入式媒体",caption:"媒体库",dragTip:"点击或拖动文件至此",dropTip:"放开鼠标以上传",selectAll:"选择全部",deselect:"取消选择",removeSelected:"删除选中项目",externalInputPlaceHolder:"资源名称|资源地址",externalInputTip:"使用“|”分隔资源名称和资源地址",addLocalFile:"添加本地资源",addExternalSource:"添加网络资源",unnamedItem:"未命名项目",confirmInsert:"插入选中项目"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={remove:"删除",cancel:"取消",confirm:"确认",insert:"插入所选项目",width:"宽度",height:"高度",image:"图片",video:"视频",audio:"音频",embed:"嵌入式媒体",caption:"媒体库",dragTip:"点击或拖动文件至此",dropTip:"放开鼠标以上传",selectAll:"选择全部",deselect:"取消选择",removeSelected:"删除选中项目",externalInputPlaceHolder:"资源名称|资源地址",externalInputTip:"使用“|”分隔资源名称和资源地址",addLocalFile:"添加本地资源",addExternalSource:"添加网络资源",unnamedItem:"未命名项目",confirmInsert:"插入选中项目"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={remove:"Remove",cancel:"Cancel",confirm:"Confirm",insert:"Insert Selected Items",width:"Width",height:"Height",image:"Image",video:"Video",audio:"Audio",embed:"Embed",caption:"Media Library",dragTip:"Click Or Drag Files Here",dropTip:"Drop To Upload",selectAll:"Select All",deselect:"Deselect",removeSelected:"Remove Selected Items",externalInputPlaceHolder:"Source Name|Source URL",externalInputTip:'Split source name and source URL with "|", confirm by hit Enter.',addLocalFile:"Add from local",addExternalSource:"Add from Internet",unnamedItem:"Unnamed Item",confirmInsert:"Insert selected items"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(4)),r=i(n(3)),l=i(n(2));function i(e){return e&&e.__esModule?e:{default:e}}t.default={en:a.default,zh:r.default,"zh-hant":l.default}},function(t,n,a){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();a(12);var i,o=a(1),s=(i=o)&&i.__esModule?i:{default:i},c=a(0);var u={image:"image/png,image/jpeg,image/gif,image/webp,image/apng,image/svg",video:"video/mp4",audio:"audio/mp3"},d=function(t){function n(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return a.toggleSelectItem=function(e){var t=e.currentTarget.dataset.id,n=a.controller.getMediaItem(t);if(!n)return!1;n.selected?a.props.onBeforeDeselect&&!1===a.props.onBeforeDeselect([n],a.controller.getItems())||(a.controller.deselectMediaItem(t),a.props.onDeselect&&a.props.onDeselect([n],a.controller.getItems())):a.props.onBeforeSelect&&!1===a.props.onBeforeSelect([n],a.controller.getItems())||(a.controller.selectMediaItem(t),a.props.onSelect&&a.props.onSelect([n],a.controller.getItems()))},a.removeItem=function(e){var t=e.currentTarget.dataset.id,n=a.controller.getMediaItem(t);if(!n)return!1;a.props.onBeforeRemove&&!1===a.props.onBeforeRemove([n],a.controller.getItems())||(a.controller.removeMediaItem(t),a.props.onRemove&&a.props.onRemove([n],a.controller.getItems())),e.stopPropagation()},a.removeSelectedItems=function(){var e=a.controller.getSelectedItems();a.props.onBeforeRemove&&!1===a.props.onBeforeRemove(e,a.controller.getItems())||(a.controller.removeSelectedItems(),a.props.onRemove&&a.props.onRemove(e,a.controller.getItems()))},a.handleDragLeave=function(e){a.dragCounter--,0===a.dragCounter&&a.setState({draging:!1})},a.handleDragDrop=function(e){a.dragCounter=0,a.setState({draging:!1})},a.handleDragEnter=function(t){e.preventDefault(),a.dragCounter++,a.setState({draging:!0})},a.reslovePickedFiles=function(e){e.persist(),a.controller.resolveFiles({files:e.target.files,onItemReady:function(e){var t=e.id;return a.controller.selectMediaItem(t)},onAllReady:function(){return e.target.value=null}},0,a.props.accepts)},a.inputExternal=function(e){a.setState({external:r({},a.state.external,{url:e.target.value})})},a.switchExternalType=function(e){a.setState({external:r({},a.state.external,{type:e.target.dataset.type})})},a.confirmAddExternal=function(e){if("button"===e.target.nodeName.toLowerCase()||13===e.keyCode){var t=a.state.external,n=t.url,r=t.type,l=(n=n.split("|")).length>1?n[0]:a.props.language.unnamedItem;n=n.length>1?n[1]:n[0];var i="IMAGE"===r?n:null;a.controller.addItems([{thumbnail:i,url:n,name:l,type:r,id:(new Date).getTime()+"_"+(0,c.UniqueIndex)(),uploading:!1,uploadProgress:1,selected:!0}]),a.setState({showExternalForm:!1,external:{url:"",type:"IMAGE"}})}},a.toggleExternalForm=function(){a.setState({showExternalForm:!a.state.showExternalForm})},a.cancelInsert=function(){a.props.onCancel&&a.props.onCancel()},a.confirmInsert=function(){var e=a.controller.getSelectedItems();if(a.props.onBeforeInsert){var t=a.props.onBeforeInsert(e);t&&t instanceof Array?a.props.onInsert&&a.props.onInsert(t):!1!==t&&a.props.onInsert&&a.props.onInsert(e)}else a.props.onInsert&&a.props.onInsert(e)},a.state={draging:!1,error:!1,confirmable:!1,external:{url:"",type:"IMAGE"},showExternalForm:!1,allowExternal:!1,items:[]},a.dragCounter=0,a.controller=a.props.controller,a.changeListenerId=a.controller.onChange(function(e){a.setState({items:e,confirmable:e.filter(function(e){return e.selected}).length}),a.props.onChange&&a.props.onChange(e)}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,s.default.Component),l(n,[{key:"mapPropsToState",value:function(e){var t=e.accepts,n=e.externals;return{fileAccept:t?[t.image?t.image.accept||u.image:"",t.video?t.image.accept||u.video:"",t.audio?t.image.accept||u.audio:""].join(","):[u.image,u.video,u.audio].join(","),external:{url:"",type:n.image?"IMAGE":n.audio?"AUDIO":n.video?"VIDEO":n.embed?"EMBED":""},allowExternal:n&&(n.image||n.audio||n.video||n.embed)}}},{key:"componentDidMount",value:function(){this.setState(this.mapPropsToState(this.props))}},{key:"componentWillReceiveProps",value:function(e){this.setState(this.mapPropsToState(e))}},{key:"componentWillUnmount",value:function(){this.controller.offChange(this.changeListenerId)}},{key:"render",value:function(){var e=this.props,t=e.language,n=e.externals,a=(e.accepts,this.state),r=a.items,l=a.draging,i=a.confirmable,o=a.external,c=a.showExternalForm,u=a.allowExternal;return s.default.createElement("div",{className:"braft-finder"},s.default.createElement("div",{onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDrop:this.handleDragDrop,className:"bf-uploader"},s.default.createElement("div",{className:"bf-drag-uploader "+(l||!r.length?"active ":" ")+(l?"draging":"")},s.default.createElement("span",{className:"bf-drag-tip"},s.default.createElement("input",{accept:this.fileAccept,onChange:this.reslovePickedFiles,multiple:!0,type:"file"}),l?t.dropTip:t.dragTip)),r.length?s.default.createElement("div",{className:"bf-list-wrap"},s.default.createElement("div",{className:"bf-list-tools"},s.default.createElement("span",{onClick:this.controller.selectAllItems,className:"bf-select-all"},s.default.createElement("i",{className:"braft-icon-done"})," ",t.selectAll),s.default.createElement("span",{onClick:this.controller.deselectAllItems,disabled:!i,className:"bf-deselect-all"},s.default.createElement("i",{className:"braft-icon-close"})," ",t.deselect),s.default.createElement("span",{onClick:this.removeSelectedItems,disabled:!i,className:"bf-remove-selected"},s.default.createElement("i",{className:"braft-icon-bin"})," ",t.removeSelected)),this.buildMediaList()):null,c&&u?s.default.createElement("div",{className:"bf-add-external"},s.default.createElement("div",{className:"bf-external-form"},s.default.createElement("div",{className:"bf-external-input"},s.default.createElement("div",null,s.default.createElement("input",{onKeyDown:this.confirmAddExternal,value:o.url,onChange:this.inputExternal,placeholder:t.externalInputPlaceHolder})),s.default.createElement("button",{type:"button",onClick:this.confirmAddExternal,disabled:!o.url.trim().length},t.confirm)),s.default.createElement("div",{"data-type":o.type,className:"bf-switch-external-type"},n.image?s.default.createElement("button",{type:"button",onClick:this.switchExternalType,"data-type":"IMAGE"},t.image):null,n.audio?s.default.createElement("button",{type:"button",onClick:this.switchExternalType,"data-type":"AUDIO"},t.audio):null,n.video?s.default.createElement("button",{type:"button",onClick:this.switchExternalType,"data-type":"VIDEO"},t.video):null,n.embed?s.default.createElement("button",{type:"button",onClick:this.switchExternalType,"data-type":"EMBED"},t.embed):null),s.default.createElement("span",{className:"bf-external-tip"},t.externalInputTip))):null),s.default.createElement("footer",{className:"bf-manager-footer"},s.default.createElement("div",{className:"pull-left"},u?s.default.createElement("span",{onClick:this.toggleExternalForm,className:"bf-toggle-external-form"},c?s.default.createElement("span",{className:"bf-bottom-text"},s.default.createElement("i",{className:"braft-icon-add"})," ",t.addLocalFile):s.default.createElement("span",{className:"bf-bottom-text"},s.default.createElement("i",{className:"braft-icon-add"})," ",t.addExternalSource)):null),s.default.createElement("div",{className:"pull-right"},s.default.createElement("button",{onClick:this.confirmInsert,className:"button button-insert",disabled:!i},t.insert),s.default.createElement("button",{onClick:this.cancel,className:"button button-cancel"},t.cancel))))}},{key:"buildMediaList",value:function(){var e=this;return s.default.createElement("ul",{className:"bf-list"},s.default.createElement("li",{className:"bf-add-item"},s.default.createElement("i",{className:"braft-icon-add"}),s.default.createElement("input",{accept:this.fileAccept,onChange:this.reslovePickedFiles,multiple:!0,type:"file"})),this.state.items.map(function(t,n){var a=null,r=t.uploading&&!e.props.hideProgress?s.default.createElement("div",{className:"bf-item-uploading"},s.default.createElement("div",{className:"bf-item-uploading-bar",style:{width:t.uploadProgress/1+"%"}})):"";switch(t.type){case"IMAGE":a=s.default.createElement("div",{className:"bf-image"},r,s.default.createElement("img",{src:t.thumbnail||t.url}));break;case"VIDEO":a=s.default.createElement("div",{className:"bf-icon bf-video",title:t.url},r,s.default.createElement("i",{className:"braft-icon-film"}),s.default.createElement("span",null,t.name||t.url));break;case"AUDIO":a=s.default.createElement("div",{className:"bf-icon bf-audio",title:t.url},r,s.default.createElement("i",{className:"braft-icon-music"}),s.default.createElement("span",null,t.name||t.url));break;case"EMBED":a=s.default.createElement("div",{className:"bf-icon bf-embed",title:t.url},r,s.default.createElement("i",{className:"braft-icon-code"}),s.default.createElement("span",null,t.name||e.props.language.embed));break;default:a=s.default.createElement("a",{className:"bf-icon bf-file",title:t.url,href:t.url},r,s.default.createElement("i",{className:"braft-icon-file-text"}),s.default.createElement("span",null,t.name||t.url))}var l=["bf-item"];return t.selected&&l.push("active"),t.uploading&&l.push("uploading"),t.error&&l.push("error"),s.default.createElement("li",{key:n,title:t.name,"data-id":t.id,className:l.join(" "),onClick:e.toggleSelectItem},a,s.default.createElement("span",{"data-id":t.id,onClick:e.removeItem,className:"bf-item-remove braft-icon-close"}),s.default.createElement("span",{className:"bf-item-title"},t.name))}))}}]),n}();d.defaultProps={accepts:{image:!0,video:!0,audio:!0,embed:!0},externals:{image:!0,video:!0,audio:!0,embed:!0}},n.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=n(0);function l(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=function(){return!0},o=function(){var e=this;this.setProps=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.items=t.items||e.items||[],e.uploadFn=t.uploader,e.validateFn=t.validator||i},this.getMediaItem=function(t){return e.items.find(function(e){return e.id===t})},this.getSelectedItems=function(){return e.items.filter(function(e){return e.selected})},this.getItems=function(){return e.items},this.setItems=function(t){e.items=t.map(function(e){return a({},e,{id:e.id.toString()})})||[],e.applyChange(),e.uploadItems()},this.addMediaItem=function(t){e.addItems([t])},this.addItems=function(t){e.items=[].concat(l(e.items),l(t.map(function(e){return a({},e,{id:e.id.toString()})}))),e.applyChange(),e.uploadItems()},this.selectMediaItem=function(t){var n=e.getMediaItem(t);if(n&&(n.uploading||n.error))return!1;e.setMediaItemState(t,{selected:!0})},this.selectAllItems=function(){e.items=e.items.filter(function(e){return!e.error&&!e.uploading}).map(function(e){return a({},e,{selected:!0})}),e.applyChange()},this.deselectMediaItem=function(t){e.setMediaItemState(t,{selected:!1})},this.deselectAllItems=function(){e.items=e.items.map(function(e){return a({},e,{selected:!1})}),e.applyChange()},this.removeMediaItem=function(t){e.items=e.items.filter(function(e){return e.id!==t}),e.applyChange()},this.removeItems=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.items=e.items.filter(function(e){return!t.includes(e.id)}),e.applyChange()},this.removeSelectedItems=function(){e.items=e.items.filter(function(e){return!e.selected}),e.applyChange()},this.removeErrorItems=function(){e.items=e.items.filter(function(e){return!e.error}),e.applyChange()},this.removeAllItems=function(){e.items=[],e.applyChange()},this.setMediaItemState=function(t,n){e.items=e.items.map(function(e){return e.id===t?a({},e,n):e}),e.applyChange()},this.reuploadErrorItems=function(){e.uploadItems(!0)},this.uploadItems=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.items.forEach(function(n,a){if(n.uploading||n.url)return!1;if(!t&&n.error)return!1;if("IMAGE"===n.type)e.createThumbnail(n),e.uploadFn=e.uploadFn||e.createInlineImage;else if(!e.uploadFn)return e.setMediaItemState(n.id,{error:1}),!1;e.setMediaItemState(n.id,{uploading:!0,uploadProgress:0,error:0}),e.uploadFn({id:n.id,file:n.file,success:function(t){e.handleUploadSuccess(n.id,t)},progress:function(t){e.setMediaItemState(n.id,{uploading:!0,uploadProgress:t})},error:function(t){e.setMediaItemState(n.id,{uploading:!1,error:2})}})})},this.createThumbnail=function(t){var n=t.id,a=t.file;e.compressImage({url:URL.createObjectURL(a),width:226,height:226,success:function(t){e.setMediaItemState(n,{thumbnail:t.url})}})},this.createInlineImage=function(t){e.compressImage({url:URL.createObjectURL(t.file),width:1280,height:800,success:function(e){t.success({url:e.url})},error:function(e){t.error(e)}})},this.handleUploadSuccess=function(t,n){e.setMediaItemState(t,a({},n,{file:null,uploadProgress:1,uploading:!1,selected:!1}));var r=e.getMediaItem(n.id||t);r.onReady&&r.onReady(r)},this.compressImage=function(e){var t=new Image,n=document.createElement("canvas");t.src=e.url,t.onload=function(){var t=1;if(!(this.width>e.width||this.height>e.height))return e.success({url:e.url,width:this.width,height:this.height}),!1;t=this.width>this.height?e.width/this.width:e.height/this.height,n.width=this.width*t,n.height=this.height*t,n.getContext("2d").drawImage(this,0,0,n.width,n.height),e.success({url:n.toDataURL("image/png",1),width:n.width,height:n.height})},t.onerror=function(t){e.error&&e.error(t)}},this.applyChange=function(){e.changeListeners.forEach(function(t){return(0,t.callback)(e.items)})},this.uploadImage=function(t,n){var a=(new Date).getTime()+"_"+(0,r.UniqueIndex)();e.addMediaItem({type:"IMAGE",id:a,file:t,name:a,size:t.size,uploadProgress:0,uploading:!1,selected:!1,error:0,onReady:n})},this.uploadImageRecursively=function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t[a]&&t[a].type.indexOf("image")>-1?e.uploadImage(t[a],function(r){n&&n(r),a<t.length-1&&e.uploadImageRecursively(t,n,a+1)}):a<t.length-1&&e.uploadImageRecursively(t,n,a+1)},this.resolveFiles=function(t,n,a){if(n<t.files.length){if(e.validateFn(t.files[n])){var l={id:(new Date).getTime()+"_"+(0,r.UniqueIndex)(),file:t.files[n],name:t.files[n].name,size:t.files[n].size,uploadProgress:0,uploading:!1,selected:!1,error:0,onReady:function(e){t.onItemReady&&t.onItemReady(e)}};0===t.files[n].type.indexOf("image/")&&a.image?(l.type="IMAGE",e.addMediaItem(l)):0===t.files[n].type.indexOf("video/")&&a.video?(l.type="VIDEO",e.addMediaItem(l)):0===t.files[n].type.indexOf("audio/")&&a.audio&&(l.type="AUDIO",e.addMediaItem(l))}setTimeout(function(){e.resolveFiles(t,n+1,a)},60)}else t.onAllReady&&t.onAllReady()},this.onChange=function(t){var n=(0,r.UniqueIndex)();return e.changeListeners.push({id:n,callback:t}),n},this.offChange=function(t){e.changeListeners=e.changeListeners.filter(function(e){return e.id!==t})}};t.default=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o.call(this),this.items=t.items||[],this.uploadFn=t.uploader,this.validateFn=t.validator||i,this.changeListeners=[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=s(n(1)),l=s(n(7)),i=s(n(6)),o=s(n(5));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=new l.default(e);return t.ReactComponent=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=a({},e,n),s=l.language&&o.default[l.language]||o.default.zh;return r.default.createElement(i.default,a({},l,{language:s,controller:t}))},t}},,,,function(e,t){}])});